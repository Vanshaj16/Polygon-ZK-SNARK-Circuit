# Project: ZK Circuit Implementation
This project demonstrates the implementation of a Zero-Knowledge (ZK) circuit using Circom and Hardhat. The project involves writing a Circom circuit, compiling it, generating a proof, deploying a verifier contract to a testnet(Sepolia), and verifying the proof to get output "0" for the input "A=0" and "B=1".

## Description
1. Circuit Implementation: Define a Circom circuit (circuit.circom) that uses AND, NOT, and OR gates to compute an output(Q) based on two input signals(A,B).
2. Compile the Circuit: Use Hardhat to compile the Circom circuit, generating necessary intermediaries like R1CS, WASM, and witness files.
3. Generate a Proof: Create an input file with specific values (A=0, B=1), generate the witness, and produce the proof and public signals using the SnarkJS toolkit.
4. Deploy the Verifier Contract: Deploy a precompiled Solidity verifier contract to a testnet (Sepolia) using Hardhat.
5. Verify the Proof: Use a test script to call the verifyProof() method on the deployed verifier contract and assert that the output is true.
### Technologies Used:
1. Circom: For writing and compiling ZK circuits.
2. SnarkJS: For generating proofs and public signals.
3. Hardhat: For managing the Solidity contract deployment and testing workflow.
4. Solidity: For writing the verifier contract.
5. Node.js: For scripting and automation tasks.
   
## Getting Started
Compile the Multiplier2() circuit and verify it against a smart contract verifier
```
pragma circom 2.0.0;

template Multiplier2 () {  
 // signal inputs
    signal input A;
    signal input B;

    // signals from gates
    signal X;
    signal Y;
     
    // final siganl output
    signal output Q;

    // component gates used to create project circuit
    component andGate = AND();
    component notGate = NOT();
    component orGate = OR();

    // circuit logic
    andGate.a <== A;
    andGate.b <== B;
    X <== andGate.out;

    notGate.in <== B;
    Y <== notGate.out;

    orGate.a <== X;
    orGate.b <== Y;
    Q <== orGate.out;
}
template AND() {
    signal input a;
    signal input b;
    signal output out;

    out <== a*b;
}
template NOT() {
    signal input in;
    signal output out;

    out <== 1 + in - 2*in;
}
template OR() {
    signal input a;
    signal input b;
    signal output out;

    out <== a + b - a*b;
}

component main = Multiplier2();
```
### Install
`npm i`

`npm install dotenv --save`= To install the dotenv 

Change the name of .env.examples to .env, which stores the private key of the account from which we are deploying our contract.

### Compile
`npx hardhat circom` 
This will generate the **out** file with circuit intermediaries and geneate the **MultiplierVerifier.sol** contract

### Prove and Deploy
`npx hardhat run scripts/deploy.ts`

This script does 4 things  
1. Deploys the MultiplierVerifier.sol contract
2. Generates a proof from circuit intermediaries with `generateProof()`
3. Generates calldata with `generateCallData()`
4. Calls `verifyProof()` on the verifier contract with calldata i.e assert that the output is true for input A=0, B=1 gives X=Y=Q=0.

## Configuration
### Directory Structure
**circuits**
```
├── multiplier
│   ├── circuit.circom
│   ├── input.json
│   └── out
│       ├── circuit.wasm
│       ├── multiplier.r1cs
│       ├── multiplier.vkey
│       └── multiplier.zkey
├── new-circuit
└── powersOfTau28_hez_final_12.ptau
```
Each new circuit lives in it's own directory. At the top level of each circuit directory lives the circom circuit and input to the circuit.
The **out** directory will be autogenerated and store the compiled outputs, keys, and proofs. The Powers of Tau file comes from the Polygon Hermez ceremony, which saves time by not needing a new ceremony. 

**contracts**
```
contracts
└── MultiplierVerifier.sol
```
Verifier contracts are autogenerated and prefixed by the circuit name, in this example **Multiplier**

## hardhat.config.ts
```
 import { HardhatUserConfig } from "hardhat/config";
import "@nomicfoundation/hardhat-toolbox";
// https://github.com/projectsophon/hardhat-circom
import "hardhat-circom";
// circuits
import circuits = require('./circuits.config.json')
import 'dotenv/config'

// set env var to the root of the project
process.env.BASE_PATH = __dirname;

// tasks
import "./tasks/newcircuit.ts"

const config: HardhatUserConfig = {
  solidity: {
    compilers: [
      {
        version: "0.8.17",
      },
      {
        version: "0.6.11",
      }
    ]
  },
  networks: {
    sepolia: {
      url: `https://sepolia.infura.io/v3/3e071b3bb5104e668bd64fbe603f9dba`,
      accounts: [process.env.SEPOLIAPRIVATEKEY],
    },
  },
  circom: {
    // (optional) Base path for input files, defaults to `./circuits/`
    inputBasePath: "./circuits",
    // (required) The final ptau file, relative to inputBasePath, from a Phase 1 ceremony
    ptau: "powersOfTau28_hez_final_12.ptau",
    // (required) Each object in this array refers to a separate circuit
    circuits: JSON.parse(JSON.stringify(circuits))
  },
};

export default config;
```
### circuits.config.json
circuits configuation is separated from hardhat.config.ts for **autogenerated** purposes (see next section)
```
[
  {
    "name": "multiplier",
    "protocol": "groth16",
    "circuit": "multiplier/circuit.circom",
    "input": "multiplier/input.json",
    "wasm": "multiplier/out/circuit.wasm",
    "zkey": "multiplier/out/multiplier.zkey",
    "vkey": "multiplier/out/multiplier.vkey",
    "r1cs": "multiplier/out/multiplier.r1cs",
    "beacon": "0102030405060708090a0b0c0d0e0f101112131415161718191a1b1c1d1e1f"
  }
]
```

## Authors

Vanshaj

vanshajsen16@gmail.com

